<?xml version="1.0" encoding="UTF-8"?>
<sml:SensorML xmlns:sml="http://www.opengis.net/sensorML" xmlns:swe="http://www.opengis.net/swe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/sensorML http://vast.uah.edu/schemas/sensorML/1.0.30/base/sensorML.xsd" version="1.0">
   <sml:ProcessChain id="PROCESS_CHAIN">
      <sml:description>
         <swe:Discussion>
            This process chain computes location of a satellite using TLE and an SGP4 propagator
            and geocentric pointing orientation in ECEF.
         </swe:Discussion>
      </sml:description>
      <!--~~~~~~~~~~~~~~~~~~-->
      <!-- Inputs & Outputs -->
      <!--~~~~~~~~~~~~~~~~~~-->
      <sml:inputs>
         <sml:InputList>
            <sml:input name="julianTime">
               <swe:Time definition="urn:ogc:def:phenomenon:time" referenceTimeFrame="urn:ogc:def:crs:julianTime" uom="s"/>
            </sml:input>
         </sml:InputList>
      </sml:inputs>
      <sml:outputs>
         <sml:OutputList>
            <sml:output name="ecefPositionMatrix">
               <swe:DataArray arraySize="16">
                  <swe:component>
                     <swe:Quantity/>
                  </swe:component>
               </swe:DataArray>
            </sml:output>          
         </sml:OutputList>
      </sml:outputs>
      <sml:processes>
         <sml:ProcessList>
            <!--~~~~~~~~~~~~~~-->
            <!-- TLE Provider -->
            <!--~~~~~~~~~~~~~~-->
            <sml:process name="tle">
               <sml:ProcessModel id="PROCESS_ID">
                  <!-- METADATA -->
                  <sml:description>
                     <swe:Discussion>
                        Loads TLE data from a TLE data file and outputs
                        the TLE corresponding to the requested time.
                     </swe:Discussion>
                  </sml:description>
                  <!-- INPUTS -->
                  <sml:inputs>
                     <sml:InputList>
                        <sml:input name="julianTime">
                           <swe:Time definition="urn:ogc:def:phenomenon:time" referenceTimeFrame="urn:ogc:def:crs:julianTime" uom="s"/>            
                        </sml:input>
                     </sml:InputList>
                  </sml:inputs>
                  <!-- OUTPUTS -->
                  <sml:outputs>
                     <sml:OutputList>
                        <sml:output name="elements">
                           <swe:DataGroup id="TLE_DATA" definition="urn:ogc:def:data:noradElements">
                              <swe:component name="epochYear">
                                 <swe:Quantity uom="a_g"/>
                              </swe:component>
                              <swe:component name="epochDay">
                                 <swe:Quantity uom="d"/>
                              </swe:component>
                              <swe:component name="bstar">
                                 <swe:Quantity uom=""/>
                              </swe:component>
                              <swe:component name="inclination">
                                 <swe:Quantity uom="deg"/>
                              </swe:component>
                              <swe:component name="rightAscension">
                                 <swe:Quantity uom="deg"/>
                              </swe:component>
                              <swe:component name="eccentricity">
                                 <swe:Quantity/>
                              </swe:component>
                              <swe:component name="argOfPerigee">
                                 <swe:Quantity uom="deg"/>
                              </swe:component>
                              <swe:component name="meanAnomaly">
                                 <swe:Quantity uom="deg"/>
                              </swe:component>
                              <swe:component name="meanMotion">
                                 <swe:Quantity uom="d-1"/>
                              </swe:component>
                           </swe:DataGroup>
                        </sml:output>
                     </sml:OutputList>
                  </sml:outputs>
                  <!-- PARAMETERS -->
                  <sml:parameters>
                     <sml:ParameterList>
                        <sml:parameter name="tleDataUrl">
                           <swe:Category>D:/Temp/noaa-13.txt</swe:Category>
                        </sml:parameter>
                     </sml:ParameterList>
                  </sml:parameters>
                  <!-- METHOD -->
                  <sml:method xlink:href="urn:vast:def:process:tleParser:1.0"/>
               </sml:ProcessModel>
            </sml:process>
            <!--~~~~~~~~~~~~~~~~~-->
            <!-- SGP4 Propagator -->
            <!--~~~~~~~~~~~~~~~~~-->
            <sml:process name="sgp4">
               <sml:ProcessModel>
                  <sml:inputs>
                     <sml:InputList>
                        <sml:input name="julianTime">
                           <swe:Time definition="urn:ogc:def:phenomenon:time" referenceTimeFrame="urn:ogc:def:crs:julianTime" uom="s"/>
                        </sml:input>
                     </sml:InputList>
                  </sml:inputs>
                  <sml:outputs>
                     <sml:OutputList>
                        <sml:output name="ECI_location">
                           <swe:Vector definition="urn:ogc:def:data:locationVector" referenceFrame="urn:ogc:def:crs:ECI_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:output>
                        <sml:output name="ECI_velocity">
                           <swe:Vector definition="urn:ogc:def:data:velocityVector" referenceFrame="urn:ogc:def:crs:ECI_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:output>
                     </sml:OutputList>
                  </sml:outputs>
                  <sml:parameters>
                     <sml:ParameterList>
                        <sml:parameter name="elements" xlink:href="#TLE_DATA"/>
                     </sml:ParameterList>
                  </sml:parameters>
                  <sml:method xlink:href="urn:ogc:def:process:SGP4:1.0"/>
               </sml:ProcessModel>
            </sml:process>            
            <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
            <!-- Transformation of Velocity Vector from ECI to ECEF -->
            <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
            <sml:process name="eciVelToEcef">
               <sml:ProcessModel>
                  <sml:inputs>
                     <sml:InputList>
                        <sml:input name="julianTime">
                           <swe:Time definition="urn:ogc:def:phenomenon:time" referenceTimeFrame="urn:ogc:def:crs:julianTime" uom="s"/>
                        </sml:input>
                        <sml:input name="ECI_velocity">
                           <swe:Vector definition="urn:ogc:def:data:velocityVector" referenceFrame="urn:ogc:def:crs:ECI_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:input>
                     </sml:InputList>
                  </sml:inputs>
                  <sml:outputs>
                     <sml:OutputList>
                        <sml:output name="ECEF_velocity">
                           <swe:Vector definition="urn:ogc:def:data:velocityVector" referenceFrame="urn:ogc:def:crs:ECEF_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:output>
                     </sml:OutputList>
                  </sml:outputs>
                  <sml:method xlink:href="urn:ogc:def:process:eciVelToEcef:1.0"/>
               </sml:ProcessModel>
            </sml:process>
            <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
            <!-- Transformation of Location Vector from ECI to ECEF -->
            <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
            <sml:process name="eciToEcef">
               <sml:ProcessModel>
                  <sml:inputs>
                     <sml:InputList>
                        <sml:input name="julianTime">
                           <swe:Time definition="urn:ogc:def:phenomenon:time" referenceTimeFrame="urn:ogc:def:crs:julianTime" uom="s"/>
                        </sml:input>
                        <sml:input name="ECI_location">
                           <swe:Vector definition="urn:ogc:def:data:locationVector" referenceFrame="urn:ogc:def:crs:ECI_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:input>
                     </sml:InputList>
                  </sml:inputs>
                  <sml:outputs>
                     <sml:OutputList>
                        <sml:output name="ECEF_location">
                           <swe:Vector definition="urn:ogc:def:data:locationVector" referenceFrame="urn:ogc:def:crs:ECEF_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:output>
                     </sml:OutputList>
                  </sml:outputs>
                  <sml:method xlink:href="urn:ogc:def:process:eciToEcef:1.0"/>
               </sml:ProcessModel>
            </sml:process>
            <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
            <!-- Geocentric Pointing Position -->
            <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
            <sml:process name="geocentricPointing">
               <sml:ProcessModel>
                  <sml:inputs>
                     <sml:InputList>
                        <sml:input name="location">
                           <swe:Vector definition="urn:ogc:def:data:locationVector" referenceFrame="urn:ogc:def:crs:ECEF_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:input>
                        <sml:input name="velocity">
                           <swe:Vector definition="urn:ogc:def:data:velocityVector" referenceFrame="urn:ogc:def:crs:ECEF_wgs84">
                              <swe:coordinate name="x">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="y">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                              <swe:coordinate name="z">
                                 <swe:Quantity uom="m/s"/>
                              </swe:coordinate>
                           </swe:Vector>
                        </sml:input>
                     </sml:InputList>
                  </sml:inputs>
                  <sml:outputs>
                     <sml:OutputList>
                        <sml:output name="posMatrix">
                           <swe:DataArray definition="urn:ogc:def:data:positionMatrix" arraySize="16">
                              <swe:component>
                                 <swe:Quantity/>
                              </swe:component>
                           </swe:DataArray>
                        </sml:output>
                     </sml:OutputList>
                  </sml:outputs>
                  <sml:parameters>
                     <sml:ParameterList>
                        <sml:parameter name="upAxis">
                           <swe:Category>Z</swe:Category>
                        </sml:parameter>
                        <sml:parameter name="forwardAxis">
                           <swe:Category>Y</swe:Category>
                        </sml:parameter>
                     </sml:ParameterList>
                  </sml:parameters>
                  <sml:method xlink:href="urn:ogc:def:process:geocentricPointing:1.0"/>
               </sml:ProcessModel>
            </sml:process>
         </sml:ProcessList>
      </sml:processes>
      <!--~~~~~~~~~~~~~-->
      <!-- Connections -->
      <!--~~~~~~~~~~~~~-->
      <sml:connections>
         <sml:ConnectionList>
            <!-- Time Input to Processes -->
            <sml:connection>
               <sml:Link>
                  <sml:source ref="this/inputs/julianTime"/>
                  <sml:destination ref="tle/inputs/julianTime"/>
               </sml:Link>
            </sml:connection>
            <sml:connection>
               <sml:Link>
                  <sml:source ref="this/inputs/julianTime"/>
                  <sml:destination ref="sgp4/inputs/julianTime"/>
               </sml:Link>
            </sml:connection>
            <sml:connection>
               <sml:Link>
                  <sml:source ref="this/inputs/julianTime"/>
                  <sml:destination ref="eciToEcef/inputs/julianTime"/>
               </sml:Link>
            </sml:connection>
            <sml:connection>
               <sml:Link>
                  <sml:source ref="this/inputs/julianTime"/>
                  <sml:destination ref="eciVelToEcef/inputs/julianTime"/>
               </sml:Link>
            </sml:connection>
            <!-- TLE to SGP4 -->
            <sml:connection>
               <sml:Link>
                  <sml:source ref="tle/outputs/elements"/>
                  <sml:destination ref="sgp4/parameters/elements"/>
               </sml:Link>
            </sml:connection>
            <!-- SGP4 to ECI/ECEF converters -->
            <sml:connection>
               <sml:Link>
                  <sml:source ref="sgp4/outputs/ECI_location"/>
                  <sml:destination ref="eciToEcef/inputs/ECI_location"/>
               </sml:Link>
            </sml:connection>
            <sml:connection>
               <sml:Link>
                  <sml:source ref="sgp4/outputs/ECI_velocity"/>
                  <sml:destination ref="eciVelToEcef/inputs/ECI_velocity"/>
               </sml:Link>
            </sml:connection>
            <!-- ECI/ECEF converters to Geocentric Pointing -->
            <sml:connection>
               <sml:Link>
                  <sml:source ref="eciToEcef/outputs/ECEF_location"/>
                  <sml:destination ref="geocentricPointing/inputs/location"/>
               </sml:Link>
            </sml:connection>
            <sml:connection>
               <sml:Link>
                  <sml:source ref="eciVelToEcef/outputs/ECEF_velocity"/>
                  <sml:destination ref="geocentricPointing/inputs/velocity"/>
               </sml:Link>
            </sml:connection>
            <!-- Geocentric pointing to Matrix Output -->
            <sml:connection>
               <sml:Link>
                  <sml:source ref="geocentricPointing/outputs/posMatrix"/>
                  <sml:destination ref="this/outputs/ecefPositionMatrix"/>
               </sml:Link>
            </sml:connection>
         </sml:ConnectionList>
      </sml:connections>
   </sml:ProcessChain>
</sml:SensorML>
